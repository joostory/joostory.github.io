<!DOCTYPE html><html lang="ko"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="shortcut icon" href="/favicon.ico"/><meta name="description" content="JooStory.net"/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><link rel="canonical" href="https://blog.joostory.net/583"/><title>Github Actions 사용한 electron build</title><meta property="og:type" content="article"/><meta property="og:title" content="Github Actions 사용한 electron build"/><meta property="og:description" content="Github Actions는 예전부터 사용할 수 있었지만 마땅히 사용할 곳이 없었다. Tistory Editor는 travis-ci로 멀쩡히 잘 동작하고 있어서 굳이 바꾸면서 고생하기는 싫고 이걸 위해서 따로 뭔가를 만들기도 뭣하고 해서 사용을 안하고 있었다.
Github Actions로 변경한 이유
&lt;code&gt;script:
- if [[ &amp;quot;$TRAVIS_OS_NAME&amp;quot; == &amp;quot;linux&amp;quot; ]]; then npm ru"/><meta property="og:image" content="https://t1.daumcdn.net/tistory_admin/static/images/openGraph/opengraph.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Github Actions 사용한 electron build"/><meta name="twitter:description" content="Github Actions는 예전부터 사용할 수 있었지만 마땅히 사용할 곳이 없었다. Tistory Editor는 travis-ci로 멀쩡히 잘 동작하고 있어서 굳이 바꾸면서 고생하기는 싫고 이걸 위해서 따로 뭔가를 만들기도 뭣하고 해서 사용을 안하고 있었다.
Github Actions로 변경한 이유
&lt;code&gt;script:
- if [[ &amp;quot;$TRAVIS_OS_NAME&amp;quot; == &amp;quot;linux&amp;quot; ]]; then npm ru"/><meta property="twitter:image" content="https://t1.daumcdn.net/tistory_admin/static/images/openGraph/opengraph.png"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/11ae7950df9656c6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/11ae7950df9656c6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-f4ae3437c92c1efc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f76bbe1730ea85a1.js" defer=""></script><script src="/_next/static/chunks/494-fa03e5491fc3b3a9.js" defer=""></script><script src="/_next/static/chunks/pages/tistory/%5Bid%5D-571a42114028488a.js" defer=""></script><script src="/_next/static/k2SjylS4DhAPzPoZgQ49x/_buildManifest.js" defer=""></script><script src="/_next/static/k2SjylS4DhAPzPoZgQ49x/_ssgManifest.js" defer=""></script><script src="/_next/static/k2SjylS4DhAPzPoZgQ49x/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen"><main><div class=""><div class="pt-40 pb-36 px-20 border-b-[1px] relative"><h1 class="font-bold tracking-tighter leading-tight md:leading-none mb-4 text-center text-3xl">Github Actions 사용한 electron build</h1><div class="flex justify-center"><em class="text-sm"><time dateTime="2019. 12. 4. 00:22">2019. 12. 4. 00:22</time></em></div></div><div class="w-[650px] pt-10 pb-20 mx-auto"><article class="prose"><p>Github Actions는 예전부터 사용할 수 있었지만 마땅히 사용할 곳이 없었다. Tistory Editor는 travis-ci로 멀쩡히 잘 동작하고 있어서 굳이 바꾸면서 고생하기는 싫고 이걸 위해서 따로 뭔가를 만들기도 뭣하고 해서 사용을 안하고 있었다.</p>
<h2>Github Actions로 변경한 이유</h2>
<pre><code>script:
- if [[ &quot;$TRAVIS_OS_NAME&quot; == &quot;linux&quot; ]]; then npm run build; npm run dist -- -l; fi
- if [[ &quot;$TRAVIS_OS_NAME&quot; == &quot;osx&quot; ]]; then npm run build; npm run dist -- -mw; fi</code></pre><p>그럼 왜 변경했느냐? Tistory Editor는 travis에서 이렇게 2번의 빌드로 3개의 플랫폼 빌드를 만들어내고 있었다. 그런데 osx에서 windows 빌드를 만드는 것에서 문제가 생겼다. 라이브러리한 곳에서 문제가 발생하고 있는데 너무나 많은 라이브러리를 사용하고 있는 상황이라 이걸 추적하는 것이 쉽지 않았다.</p>
<p>가장 쉬운 해결방법은 windows에서 빌드를 하는 것인데 안타깝게도 travis는 windows환경을 제공하지 않는다. 그때 github actions에서 windows환경을 제공하는 것이 생각났다. 그래서 이번 기회에 옮겨보기로 했다.</p>
<h2>Github Actions 사용법</h2>
<p>Github Actions는 <a href="https://blog.joostory.net/582">이전 글</a>에서도 정리했듯 workflow에 조건(on), 수행할 일(job)을 정리하면 된다.</p>
<pre><code>name: Release

on:
  push:
    tags:
      - v*

jobs:
  build:

    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [macOS-latest, windows-latest, ubuntu-latest]

    steps:
      - name: Context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo &quot;$GITHUB_CONTEXT&quot;
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1
      - name: Use Node.js 10.x
        uses: actions/setup-node@v1
        with:
          node-version: 10.x
      - name: Decrypt secret
        run: ./.github/scripts/decrypt_secret.sh
        env:
          BUILD_KEY: ${{ secrets.BUILD_KEY }}
          BUILD_IV: ${{ secrets.BUILD_IV }}
      - name: npm install
        run: |
          npm install
      - name: npm build
        run: |
          npm run build
      - name: electron build
        run: |
          npm run dist
      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, &#39;refs/tags/&#39;)
        with:
          files: &quot;dist/TistoryEditor*&quot;
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}</code></pre><p>많은 시행착오 끝에 정리한 이 workflow를 보면 대략 github actions의 동작을 알 수 있다. 먼저 이 workflow는 <code>v</code>로 시작하는 tag가 생성되면 수행된다.</p>
<pre><code>on:
  push:
    tags:
      - v*</code></pre><p>job은 3개의 os에서 각각 수행되도록 했다. matrix.os 에 원하는 os 버전을 설정하고 <code>runs-on</code>으로 수행하면 된다.</p>
<pre><code>    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [macOS-latest, windows-latest, ubuntu-latest]</code></pre><p>이제 가장 시행착오가 많았던 부분이다. secret data를 decrypt하는 것이다. 분명히 github actions의 문서에서는 gpg를 사용하라고 나와있는데 분명히 linux만 있을때 작성된 문서일 것이다. mac, windows에서는 gpg가 없다. 따로 설치해야한다. openssl로 key, iv 사용하면 모든 os에서 잘 된다.</p>
<pre><code>      - name: Decrypt secret
        run: ./.github/scripts/decrypt_secret.sh
        env:
          BUILD_KEY: ${{ secrets.BUILD_KEY }}
          BUILD_IV: ${{ secrets.BUILD_IV }}</code></pre><p>마지막으로 release다. 이미 누가 만들어 둔 것이 있으니 <code>softprops/action-gh-release</code> 이걸 사용하면 된다. ref가 tags이면 build결과물을 지정해서 업로드하라고 하면된다. 여러가지 옵션이 있는데 draft, prerelease로 할 수도 있고 폴더전체를 업로드할 수도 있다.</p>
<pre><code>      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, &#39;refs/tags/&#39;)
        with:
          files: &quot;dist/TistoryEditor*&quot;
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}</code></pre><p>이렇게 시행착오를 겪은 actions이 완성됐다. 아직 조금 더 조정할 부분이 있는데 일단 이 정도에서 마무리하려고 한다. 이렇게 만들어두고보니 뭔가 또 수정해서 빌드해보고 싶다.</p>
            </article></div></div></main></div><footer class="bg-slate-100 border-t border-accent-2 mt-6"><div class="py-4 flex flex-col items-center justify-center text-xs text-slate-500"><a href="https://twitter.com/@JooStory">@JooStory</a></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"583","date":"2019. 12. 4. 00:22","title":"Github Actions 사용한 electron build","content":"\u003cp\u003eGithub Actions는 예전부터 사용할 수 있었지만 마땅히 사용할 곳이 없었다. Tistory Editor는 travis-ci로 멀쩡히 잘 동작하고 있어서 굳이 바꾸면서 고생하기는 싫고 이걸 위해서 따로 뭔가를 만들기도 뭣하고 해서 사용을 안하고 있었다.\u003c/p\u003e\n\u003ch2\u003eGithub Actions로 변경한 이유\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003escript:\n- if [[ \u0026quot;$TRAVIS_OS_NAME\u0026quot; == \u0026quot;linux\u0026quot; ]]; then npm run build; npm run dist -- -l; fi\n- if [[ \u0026quot;$TRAVIS_OS_NAME\u0026quot; == \u0026quot;osx\u0026quot; ]]; then npm run build; npm run dist -- -mw; fi\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e그럼 왜 변경했느냐? Tistory Editor는 travis에서 이렇게 2번의 빌드로 3개의 플랫폼 빌드를 만들어내고 있었다. 그런데 osx에서 windows 빌드를 만드는 것에서 문제가 생겼다. 라이브러리한 곳에서 문제가 발생하고 있는데 너무나 많은 라이브러리를 사용하고 있는 상황이라 이걸 추적하는 것이 쉽지 않았다.\u003c/p\u003e\n\u003cp\u003e가장 쉬운 해결방법은 windows에서 빌드를 하는 것인데 안타깝게도 travis는 windows환경을 제공하지 않는다. 그때 github actions에서 windows환경을 제공하는 것이 생각났다. 그래서 이번 기회에 옮겨보기로 했다.\u003c/p\u003e\n\u003ch2\u003eGithub Actions 사용법\u003c/h2\u003e\n\u003cp\u003eGithub Actions는 \u003ca href=\"https://blog.joostory.net/582\"\u003e이전 글\u003c/a\u003e에서도 정리했듯 workflow에 조건(on), 수행할 일(job)을 정리하면 된다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ename: Release\n\non:\n  push:\n    tags:\n      - v*\n\njobs:\n  build:\n\n    runs-on: ${{ matrix.os }}\n\n    strategy:\n      matrix:\n        os: [macOS-latest, windows-latest, ubuntu-latest]\n\n    steps:\n      - name: Context\n        env:\n          GITHUB_CONTEXT: ${{ toJson(github) }}\n        run: echo \u0026quot;$GITHUB_CONTEXT\u0026quot;\n      - uses: actions/checkout@v1\n        with:\n          fetch-depth: 1\n      - name: Use Node.js 10.x\n        uses: actions/setup-node@v1\n        with:\n          node-version: 10.x\n      - name: Decrypt secret\n        run: ./.github/scripts/decrypt_secret.sh\n        env:\n          BUILD_KEY: ${{ secrets.BUILD_KEY }}\n          BUILD_IV: ${{ secrets.BUILD_IV }}\n      - name: npm install\n        run: |\n          npm install\n      - name: npm build\n        run: |\n          npm run build\n      - name: electron build\n        run: |\n          npm run dist\n      - name: Release\n        uses: softprops/action-gh-release@v1\n        if: startsWith(github.ref, \u0026#39;refs/tags/\u0026#39;)\n        with:\n          files: \u0026quot;dist/TistoryEditor*\u0026quot;\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e많은 시행착오 끝에 정리한 이 workflow를 보면 대략 github actions의 동작을 알 수 있다. 먼저 이 workflow는 \u003ccode\u003ev\u003c/code\u003e로 시작하는 tag가 생성되면 수행된다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eon:\n  push:\n    tags:\n      - v*\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ejob은 3개의 os에서 각각 수행되도록 했다. matrix.os 에 원하는 os 버전을 설정하고 \u003ccode\u003eruns-on\u003c/code\u003e으로 수행하면 된다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    runs-on: ${{ matrix.os }}\n\n    strategy:\n      matrix:\n        os: [macOS-latest, windows-latest, ubuntu-latest]\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e이제 가장 시행착오가 많았던 부분이다. secret data를 decrypt하는 것이다. 분명히 github actions의 문서에서는 gpg를 사용하라고 나와있는데 분명히 linux만 있을때 작성된 문서일 것이다. mac, windows에서는 gpg가 없다. 따로 설치해야한다. openssl로 key, iv 사용하면 모든 os에서 잘 된다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e      - name: Decrypt secret\n        run: ./.github/scripts/decrypt_secret.sh\n        env:\n          BUILD_KEY: ${{ secrets.BUILD_KEY }}\n          BUILD_IV: ${{ secrets.BUILD_IV }}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e마지막으로 release다. 이미 누가 만들어 둔 것이 있으니 \u003ccode\u003esoftprops/action-gh-release\u003c/code\u003e 이걸 사용하면 된다. ref가 tags이면 build결과물을 지정해서 업로드하라고 하면된다. 여러가지 옵션이 있는데 draft, prerelease로 할 수도 있고 폴더전체를 업로드할 수도 있다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e      - name: Release\n        uses: softprops/action-gh-release@v1\n        if: startsWith(github.ref, \u0026#39;refs/tags/\u0026#39;)\n        with:\n          files: \u0026quot;dist/TistoryEditor*\u0026quot;\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e이렇게 시행착오를 겪은 actions이 완성됐다. 아직 조금 더 조정할 부분이 있는데 일단 이 정도에서 마무리하려고 한다. 이렇게 만들어두고보니 뭔가 또 수정해서 빌드해보고 싶다.\u003c/p\u003e\n            ","summary":"Github Actions는 예전부터 사용할 수 있었지만 마땅히 사용할 곳이 없었다. Tistory Editor는 travis-ci로 멀쩡히 잘 동작하고 있어서 굳이 바꾸면서 고생하기는 싫고 이걸 위해서 따로 뭔가를 만들기도 뭣하고 해서 사용을 안하고 있었다.\nGithub Actions로 변경한 이유\n\u003ccode\u003escript:\n- if [[ \u0026quot;$TRAVIS_OS_NAME\u0026quot; == \u0026quot;linux\u0026quot; ]]; then npm ru","image":"https://t1.daumcdn.net/tistory_admin/static/images/openGraph/opengraph.png"}},"__N_SSG":true},"page":"/tistory/[id]","query":{"id":"583"},"buildId":"k2SjylS4DhAPzPoZgQ49x","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>