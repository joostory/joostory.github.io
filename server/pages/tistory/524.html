<!DOCTYPE html><html lang="ko"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="shortcut icon" href="/favicon.ico"/><meta name="description" content="JooStory.net"/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><link rel="canonical" href="https://blog.joostory.net/524"/><title>webpack-dev-middleware 시작하기</title><meta property="og:type" content="article"/><meta property="og:title" content="webpack-dev-middleware 시작하기"/><meta property="og:description" content="이전에 webpack-dev-server를 처음 적용했을때 참 편하다 생각했다. 근데 뭔가 index.html 말고 테스트 모듈도 실행해서 실제 실행 결과로 테스트 해보고 싶은 생각이 들었다. 구체적으로 예를 들자면 tinymce opengraph 플러그인에서 opengraph 샘플 데이터 말고 실제 opengraph 데이터를 가져오는 것을 보고 싶었다.
&lt;code&gt;// 지금
opengraph: {
  fetch_handler: (url, callbac"/><meta property="og:image" content="https://t1.daumcdn.net/tistory_admin/static/images/openGraph/opengraph.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="webpack-dev-middleware 시작하기"/><meta name="twitter:description" content="이전에 webpack-dev-server를 처음 적용했을때 참 편하다 생각했다. 근데 뭔가 index.html 말고 테스트 모듈도 실행해서 실제 실행 결과로 테스트 해보고 싶은 생각이 들었다. 구체적으로 예를 들자면 tinymce opengraph 플러그인에서 opengraph 샘플 데이터 말고 실제 opengraph 데이터를 가져오는 것을 보고 싶었다.
&lt;code&gt;// 지금
opengraph: {
  fetch_handler: (url, callbac"/><meta property="twitter:image" content="https://t1.daumcdn.net/tistory_admin/static/images/openGraph/opengraph.png"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/11ae7950df9656c6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/11ae7950df9656c6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-f4ae3437c92c1efc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f76bbe1730ea85a1.js" defer=""></script><script src="/_next/static/chunks/494-fa03e5491fc3b3a9.js" defer=""></script><script src="/_next/static/chunks/pages/tistory/%5Bid%5D-571a42114028488a.js" defer=""></script><script src="/_next/static/k2SjylS4DhAPzPoZgQ49x/_buildManifest.js" defer=""></script><script src="/_next/static/k2SjylS4DhAPzPoZgQ49x/_ssgManifest.js" defer=""></script><script src="/_next/static/k2SjylS4DhAPzPoZgQ49x/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen"><main><div class=""><div class="pt-40 pb-36 px-20 border-b-[1px] relative"><h1 class="font-bold tracking-tighter leading-tight md:leading-none mb-4 text-center text-3xl">webpack-dev-middleware 시작하기</h1><div class="flex justify-center"><em class="text-sm"><time dateTime="2018. 3. 3. 17:42">2018. 3. 3. 17:42</time></em></div></div><div class="w-[650px] pt-10 pb-20 mx-auto"><article class="prose"><p>이전에 <a href="http://blog.joostory.net/435">webpack-dev-server</a>를 처음 적용했을때 참 편하다 생각했다. 근데 뭔가 index.html 말고 테스트 모듈도 실행해서 실제 실행 결과로 테스트 해보고 싶은 생각이 들었다. 구체적으로 예를 들자면 tinymce opengraph 플러그인에서 opengraph 샘플 데이터 말고 실제 opengraph 데이터를 가져오는 것을 보고 싶었다.</p>
<pre><code>// 지금
opengraph: {
  fetch_handler: (url, callback) =&gt; {
    setTimeout(() =&gt; {
      if (url === "http://a.com") {
        callback({
          description: "안녕하세요, TISTORY입니다. 지난 2월 2일부터 시범운영한 로그인 보안 기능을 정식 오픈합니다. 현재까지 3천 여개의 계정에서 사용 중이며 등록된 기기는 7천 여개에 달합니다. 많은 분들의 사용으로 안정성을 확인하였으므로 이제 모든 계정에 로그인 보안 기능을 활성화하려고 합니다 로그인 보안 바로가기 Q&amp;A 정식 오픈으로 무엇이 달라지나요? 모든 계정에 로그인 보안이 기본적으로 활성화됩니다. 시범운영 기간 동안에..",
          host: "notice.tistory.com",
          mediaUrl: "",
          image: "https://t1.daumcdn.net/cfile/tistory/197F333A4F0A730C03",
          title: "당신의 블로그는 안전한가요? - 로그인 보안 기능 정식 오픈 로그인 보안 기능 정식 오픈",
          type: "article",
          url: "http://notice.tistory.com/2384"
        })
      } else {
        callback({
          description: "자유를 위해, 가족을 위해, 이 땅을 위해! '혹성탈출: 종의 전쟁(War for the Planet of the Apes)' 1차 예고편 --------- 영화 소개 --------- ▶장르(Genre) : 액션(Action), 모험(Adventure), 드라마(Drama) ▶...",
          host : "www.youtube.com",
          image : "https://i.ytimg.com/vi/W28VlDoJwGo/hqdefault.jpg",
          mediaUrl : "https://www.youtube.com/embed/W28VlDoJwGo",
          title : "[혹성탈출: 종의 전쟁] 1차 예고편 War for the Planet of the Apes 앤디 서키스,우디 해럴슨, 주디 그리어, 맷 리브스 감독 (한국어 CC)",
          type : "video",
          url : "https://www.youtube.com/watch?v=W28VlDoJwGo"
        })
      }
    }, 1000)
  }
}

// 원하는 것
opengraph: {
  fetch_handler: (url, callback) =&gt; {
    fetch(`/opengraph?url=${url}`)
      .then(res =&gt; res.json())
      .then(json =&gt; callback(json))
  }
}</code></pre>
<p>어떻게 해야할까 보다보니 webpack-dev-server로 이런 일을 할 수 있다. 어차피 node 서비스이니 api만 있다면 안될리는 없다고 생각하긴했다. 근데 설정방법이 맘에 안든다. webpack.config 안에 devServer를 추가하고 여기에 서버 로직을 넣어야 한다. 뭐 import를 하면 코드가 복잡해지는 건 해결되긴 하는데 맘에 안든다. 저걸 하느니 그냥 node 서버를 만드는게 낫겠다 싶었다.</p>
<p>webpack-dev-middleware는 바로 이런 일을 해주는 middleware다. express에 webpack.config과 함께 설정해주기만 하면 바로 사용가능하다.</p>
<pre><code>const webpack = require('webpack')
const middleware = require('webpack-dev-middleware')
const webpackConfig = require('./webpack.config')
const express = require('express')
const app = express()

app.use(middleware(webpack(webpackConfig), {
  publicPath: webpackConfig.output.publicPath
}))

app.get('/', (req, res) =&gt; {
  res.sendFile(__dirname + '/static/index.html')
})

app.listen(3000, () =&gt; console.log('tinymce-plugin-opengraph dev app listening on port 3000.'))</code></pre>
<p>이제 fetch 하는 것만 넣으면 끝.</p>            </article></div></div></main></div><footer class="bg-slate-100 border-t border-accent-2 mt-6"><div class="py-4 flex flex-col items-center justify-center text-xs text-slate-500"><a href="https://twitter.com/@JooStory">@JooStory</a></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"524","date":"2018. 3. 3. 17:42","title":"webpack-dev-middleware 시작하기","content":"\u003cp\u003e이전에 \u003ca href=\"http://blog.joostory.net/435\"\u003ewebpack-dev-server\u003c/a\u003e를 처음 적용했을때 참 편하다 생각했다. 근데 뭔가 index.html 말고 테스트 모듈도 실행해서 실제 실행 결과로 테스트 해보고 싶은 생각이 들었다. 구체적으로 예를 들자면 tinymce opengraph 플러그인에서 opengraph 샘플 데이터 말고 실제 opengraph 데이터를 가져오는 것을 보고 싶었다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e// 지금\nopengraph: {\n  fetch_handler: (url, callback) =\u0026gt; {\n    setTimeout(() =\u0026gt; {\n      if (url === \"http://a.com\") {\n        callback({\n          description: \"안녕하세요, TISTORY입니다. 지난 2월 2일부터 시범운영한 로그인 보안 기능을 정식 오픈합니다. 현재까지 3천 여개의 계정에서 사용 중이며 등록된 기기는 7천 여개에 달합니다. 많은 분들의 사용으로 안정성을 확인하였으므로 이제 모든 계정에 로그인 보안 기능을 활성화하려고 합니다 로그인 보안 바로가기 Q\u0026amp;A 정식 오픈으로 무엇이 달라지나요? 모든 계정에 로그인 보안이 기본적으로 활성화됩니다. 시범운영 기간 동안에..\",\n          host: \"notice.tistory.com\",\n          mediaUrl: \"\",\n          image: \"https://t1.daumcdn.net/cfile/tistory/197F333A4F0A730C03\",\n          title: \"당신의 블로그는 안전한가요? - 로그인 보안 기능 정식 오픈 로그인 보안 기능 정식 오픈\",\n          type: \"article\",\n          url: \"http://notice.tistory.com/2384\"\n        })\n      } else {\n        callback({\n          description: \"자유를 위해, 가족을 위해, 이 땅을 위해! '혹성탈출: 종의 전쟁(War for the Planet of the Apes)' 1차 예고편 --------- 영화 소개 --------- ▶장르(Genre) : 액션(Action), 모험(Adventure), 드라마(Drama) ▶...\",\n          host : \"www.youtube.com\",\n          image : \"https://i.ytimg.com/vi/W28VlDoJwGo/hqdefault.jpg\",\n          mediaUrl : \"https://www.youtube.com/embed/W28VlDoJwGo\",\n          title : \"[혹성탈출: 종의 전쟁] 1차 예고편 War for the Planet of the Apes 앤디 서키스,우디 해럴슨, 주디 그리어, 맷 리브스 감독 (한국어 CC)\",\n          type : \"video\",\n          url : \"https://www.youtube.com/watch?v=W28VlDoJwGo\"\n        })\n      }\n    }, 1000)\n  }\n}\n\n// 원하는 것\nopengraph: {\n  fetch_handler: (url, callback) =\u0026gt; {\n    fetch(`/opengraph?url=${url}`)\n      .then(res =\u0026gt; res.json())\n      .then(json =\u0026gt; callback(json))\n  }\n}\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e어떻게 해야할까 보다보니 webpack-dev-server로 이런 일을 할 수 있다. 어차피 node 서비스이니 api만 있다면 안될리는 없다고 생각하긴했다. 근데 설정방법이 맘에 안든다. webpack.config 안에 devServer를 추가하고 여기에 서버 로직을 넣어야 한다. 뭐 import를 하면 코드가 복잡해지는 건 해결되긴 하는데 맘에 안든다. 저걸 하느니 그냥 node 서버를 만드는게 낫겠다 싶었다.\u003c/p\u003e\n\u003cp\u003ewebpack-dev-middleware는 바로 이런 일을 해주는 middleware다. express에 webpack.config과 함께 설정해주기만 하면 바로 사용가능하다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003econst webpack = require('webpack')\nconst middleware = require('webpack-dev-middleware')\nconst webpackConfig = require('./webpack.config')\nconst express = require('express')\nconst app = express()\n\napp.use(middleware(webpack(webpackConfig), {\n  publicPath: webpackConfig.output.publicPath\n}))\n\napp.get('/', (req, res) =\u0026gt; {\n  res.sendFile(__dirname + '/static/index.html')\n})\n\napp.listen(3000, () =\u0026gt; console.log('tinymce-plugin-opengraph dev app listening on port 3000.'))\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 fetch 하는 것만 넣으면 끝.\u003c/p\u003e            ","summary":"이전에 webpack-dev-server를 처음 적용했을때 참 편하다 생각했다. 근데 뭔가 index.html 말고 테스트 모듈도 실행해서 실제 실행 결과로 테스트 해보고 싶은 생각이 들었다. 구체적으로 예를 들자면 tinymce opengraph 플러그인에서 opengraph 샘플 데이터 말고 실제 opengraph 데이터를 가져오는 것을 보고 싶었다.\n\u003ccode\u003e// 지금\nopengraph: {\n  fetch_handler: (url, callbac","image":"https://t1.daumcdn.net/tistory_admin/static/images/openGraph/opengraph.png"}},"__N_SSG":true},"page":"/tistory/[id]","query":{"id":"524"},"buildId":"k2SjylS4DhAPzPoZgQ49x","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>