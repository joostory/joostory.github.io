<!DOCTYPE html><html lang="ko"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="shortcut icon" href="/favicon.ico"/><meta name="description" content="JooStory.net"/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><link rel="canonical" href="https://blog.joostory.net/449"/><title>to-markdown에서 jsdom로드 제외</title><meta property="og:type" content="article"/><meta property="og:title" content="to-markdown에서 jsdom로드 제외"/><meta property="og:description" content="TistoryEditor를 만들기 위해서는 html to markdown, markdown to html 변환을 해야한다. tistory api에서 당연하게도 content를 html로 주기 때문이다. 그래서 수정을 하려고 할때는 markdown으로 변환하고 다시 저장할 때는 html로 변환해야한다.
makrdown to html
markdown을 html로 변환하는 것은 수요가 많기도 하겠고, markdown의 규칙이 그리 어렵지 않아서 그런지 많은 "/><meta property="og:image" content="https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&amp;fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F221E363B585E998714"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="to-markdown에서 jsdom로드 제외"/><meta name="twitter:description" content="TistoryEditor를 만들기 위해서는 html to markdown, markdown to html 변환을 해야한다. tistory api에서 당연하게도 content를 html로 주기 때문이다. 그래서 수정을 하려고 할때는 markdown으로 변환하고 다시 저장할 때는 html로 변환해야한다.
makrdown to html
markdown을 html로 변환하는 것은 수요가 많기도 하겠고, markdown의 규칙이 그리 어렵지 않아서 그런지 많은 "/><meta property="twitter:image" content="https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&amp;fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F221E363B585E998714"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/11ae7950df9656c6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/11ae7950df9656c6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-f4ae3437c92c1efc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f76bbe1730ea85a1.js" defer=""></script><script src="/_next/static/chunks/494-fa03e5491fc3b3a9.js" defer=""></script><script src="/_next/static/chunks/pages/tistory/%5Bid%5D-571a42114028488a.js" defer=""></script><script src="/_next/static/k2SjylS4DhAPzPoZgQ49x/_buildManifest.js" defer=""></script><script src="/_next/static/k2SjylS4DhAPzPoZgQ49x/_ssgManifest.js" defer=""></script><script src="/_next/static/k2SjylS4DhAPzPoZgQ49x/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen"><main><div class=""><div class="pt-40 pb-36 px-20 border-b-[1px] relative"><h1 class="font-bold tracking-tighter leading-tight md:leading-none mb-4 text-center text-3xl">to-markdown에서 jsdom로드 제외</h1><div class="flex justify-center"><em class="text-sm"><time dateTime="2016. 12. 25. 01:25">2016. 12. 25. 01:25</time></em></div></div><div class="w-[650px] pt-10 pb-20 mx-auto"><article class="prose"><p><a href="https://joostory.github.io/tistory-editor">TistoryEditor</a>를 만들기 위해서는 html to markdown, markdown to html 변환을 해야한다. tistory api에서 당연하게도 content를 html로 주기 때문이다. 그래서 수정을 하려고 할때는 markdown으로 변환하고 다시 저장할 때는 html로 변환해야한다.</p>
<h2 id="makrdown-to-html">makrdown to html</h2>
<p>markdown을 html로 변환하는 것은 수요가 많기도 하겠고, markdown의 규칙이 그리 어렵지 않아서 그런지 많은 라이브러리가 있다. 그 중에 제일 사용자가 많아보이는 <a href="https://github.com/chjj/marked">marked</a>를 사용하기로 했다. 이전에 <a href="http://dev.joostory.net/editor">티스토리에 markdown으로 글쓰려고 만든 툴</a>에서도 이걸 쓰기도 했고 <a href="https://github.com/chjj/marked#benchmarks">benchmark</a>에서 가장 빠르다고 한다. (더 빠른 것으로 보이는 <a href="https://github.com/benmills/robotskirt">robotskirt</a>는 C로 만든 node module이다. 브라우저에서 쓸 수 없다.)</p>
<h2 id="html-to-markdown">html to markdown</h2>
<p>html을 markdown으로 변환하는 것은 수요가 없어서 그런지 라이브러리가 그리 많지는 않았다. 그 중에 제일 간단하고 쓸만해보이는 <a href="https://github.com/domchristie/to-markdown">to-markdown</a>를 사용하기로 했다. 일단 동작하는데에는 문제가 없다. 내가 주로 쓰는 스타일과 다른 형태의 마크다운을 만들어주긴 하지만 상관없었다.</p>
<p>to-markdown은 node도 커버하려다보니 jsdom이라는 document를 흉내내는 라이브러리를 쓴다. 난 역시 이걸 브라우저에서 쓸거라서 jsdom은 필요없다. 하지만 to-markdown의 코드안에서 사용하는 부분이 있기 때문에 webpack이 같이 패키징한다. 이 때문에 webpack이 결과물을 만들어낼 때마다 난 이런 걸 봐야했다.</p>
<p><img src="https://t1.daumcdn.net/cfile/tistory/221E363B585E998714" alt=""></p>
<h2 id="jsdom-">jsdom를 로드하지말자</h2>
<p>모든 원흉은 jsdom이니 이걸 없애야 한다. 역시 나만 이런 생각을 하는 건 아니었다. <a href="https://github.com/webpack/webpack/issues/718">찾아본 문서</a>에는 <code>webpack.IngorePlugin</code>을 통해서 없애는 방법을 알려줬다. 근데 그렇게 하면 to-markdown 자체를 쓸 수 없는 상태가 되었다. 아마도 jsdom 자체를 로드하지 않는 것 같다. 그럼 당연히 to-markdown에서 오류가 발생할테니 아예 빼버린 것 같다.</p>
<p>다른 방법을 찾아야한다. 최악의 경우 to-markdown을 고칠 생각으로 jsdom을 어디에서 쓰는지 찾아봤다. <a href="https://github.com/domchristie/to-markdown/blob/55d8f2a5c3b98d0e16f31b7ae4b02f344fbf7e2e/lib/html-parser.js#L31">찾아보니</a> <code>document</code>가 <code>undefined</code>인 경우에만 사용된다. 브라우저에서는 당연히 저런 경우가 없다. 이런 식으로 사용된 경우엔 코드를 수정하거나 jsdom을 require할때 실제 jsdom대신 다른걸 주도록 하면 될 것 같았다. 문득 cdn으로 미리 로드한 녀석들 require할때 사용한 방법이 생각났다.</p>
<pre><code>externals: {
    &quot;jsdom&quot;: {}
}
</code></pre><p>아주 간단한 방법이다. webpack에 externals로 저렇게 설정해두면 require할때 module을 로드하는 대신 저 값을 할당한다. 이걸 했더니 to-markdown도 잘 동작하고 오류도 없어졌고 패키지된 js파일도 용량이 절반으로 줄어들었다.</p>
<hr>
<p>기쁘다. 좋다. 크리스마스 선물받은 기분이다. 이제 다음 스텝으로 후련히 갈 수 있겠다.</p>
            </article></div></div></main></div><footer class="bg-slate-100 border-t border-accent-2 mt-6"><div class="py-4 flex flex-col items-center justify-center text-xs text-slate-500"><a href="https://twitter.com/@JooStory">@JooStory</a></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"449","date":"2016. 12. 25. 01:25","title":"to-markdown에서 jsdom로드 제외","content":"\u003cp\u003e\u003ca href=\"https://joostory.github.io/tistory-editor\"\u003eTistoryEditor\u003c/a\u003e를 만들기 위해서는 html to markdown, markdown to html 변환을 해야한다. tistory api에서 당연하게도 content를 html로 주기 때문이다. 그래서 수정을 하려고 할때는 markdown으로 변환하고 다시 저장할 때는 html로 변환해야한다.\u003c/p\u003e\n\u003ch2 id=\"makrdown-to-html\"\u003emakrdown to html\u003c/h2\u003e\n\u003cp\u003emarkdown을 html로 변환하는 것은 수요가 많기도 하겠고, markdown의 규칙이 그리 어렵지 않아서 그런지 많은 라이브러리가 있다. 그 중에 제일 사용자가 많아보이는 \u003ca href=\"https://github.com/chjj/marked\"\u003emarked\u003c/a\u003e를 사용하기로 했다. 이전에 \u003ca href=\"http://dev.joostory.net/editor\"\u003e티스토리에 markdown으로 글쓰려고 만든 툴\u003c/a\u003e에서도 이걸 쓰기도 했고 \u003ca href=\"https://github.com/chjj/marked#benchmarks\"\u003ebenchmark\u003c/a\u003e에서 가장 빠르다고 한다. (더 빠른 것으로 보이는 \u003ca href=\"https://github.com/benmills/robotskirt\"\u003erobotskirt\u003c/a\u003e는 C로 만든 node module이다. 브라우저에서 쓸 수 없다.)\u003c/p\u003e\n\u003ch2 id=\"html-to-markdown\"\u003ehtml to markdown\u003c/h2\u003e\n\u003cp\u003ehtml을 markdown으로 변환하는 것은 수요가 없어서 그런지 라이브러리가 그리 많지는 않았다. 그 중에 제일 간단하고 쓸만해보이는 \u003ca href=\"https://github.com/domchristie/to-markdown\"\u003eto-markdown\u003c/a\u003e를 사용하기로 했다. 일단 동작하는데에는 문제가 없다. 내가 주로 쓰는 스타일과 다른 형태의 마크다운을 만들어주긴 하지만 상관없었다.\u003c/p\u003e\n\u003cp\u003eto-markdown은 node도 커버하려다보니 jsdom이라는 document를 흉내내는 라이브러리를 쓴다. 난 역시 이걸 브라우저에서 쓸거라서 jsdom은 필요없다. 하지만 to-markdown의 코드안에서 사용하는 부분이 있기 때문에 webpack이 같이 패키징한다. 이 때문에 webpack이 결과물을 만들어낼 때마다 난 이런 걸 봐야했다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://t1.daumcdn.net/cfile/tistory/221E363B585E998714\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"jsdom-\"\u003ejsdom를 로드하지말자\u003c/h2\u003e\n\u003cp\u003e모든 원흉은 jsdom이니 이걸 없애야 한다. 역시 나만 이런 생각을 하는 건 아니었다. \u003ca href=\"https://github.com/webpack/webpack/issues/718\"\u003e찾아본 문서\u003c/a\u003e에는 \u003ccode\u003ewebpack.IngorePlugin\u003c/code\u003e을 통해서 없애는 방법을 알려줬다. 근데 그렇게 하면 to-markdown 자체를 쓸 수 없는 상태가 되었다. 아마도 jsdom 자체를 로드하지 않는 것 같다. 그럼 당연히 to-markdown에서 오류가 발생할테니 아예 빼버린 것 같다.\u003c/p\u003e\n\u003cp\u003e다른 방법을 찾아야한다. 최악의 경우 to-markdown을 고칠 생각으로 jsdom을 어디에서 쓰는지 찾아봤다. \u003ca href=\"https://github.com/domchristie/to-markdown/blob/55d8f2a5c3b98d0e16f31b7ae4b02f344fbf7e2e/lib/html-parser.js#L31\"\u003e찾아보니\u003c/a\u003e \u003ccode\u003edocument\u003c/code\u003e가 \u003ccode\u003eundefined\u003c/code\u003e인 경우에만 사용된다. 브라우저에서는 당연히 저런 경우가 없다. 이런 식으로 사용된 경우엔 코드를 수정하거나 jsdom을 require할때 실제 jsdom대신 다른걸 주도록 하면 될 것 같았다. 문득 cdn으로 미리 로드한 녀석들 require할때 사용한 방법이 생각났다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eexternals: {\n    \u0026quot;jsdom\u0026quot;: {}\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e아주 간단한 방법이다. webpack에 externals로 저렇게 설정해두면 require할때 module을 로드하는 대신 저 값을 할당한다. 이걸 했더니 to-markdown도 잘 동작하고 오류도 없어졌고 패키지된 js파일도 용량이 절반으로 줄어들었다.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e기쁘다. 좋다. 크리스마스 선물받은 기분이다. 이제 다음 스텝으로 후련히 갈 수 있겠다.\u003c/p\u003e\n            ","summary":"TistoryEditor를 만들기 위해서는 html to markdown, markdown to html 변환을 해야한다. tistory api에서 당연하게도 content를 html로 주기 때문이다. 그래서 수정을 하려고 할때는 markdown으로 변환하고 다시 저장할 때는 html로 변환해야한다.\nmakrdown to html\nmarkdown을 html로 변환하는 것은 수요가 많기도 하겠고, markdown의 규칙이 그리 어렵지 않아서 그런지 많은 ","image":"https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2\u0026fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F221E363B585E998714"}},"__N_SSG":true},"page":"/tistory/[id]","query":{"id":"449"},"buildId":"k2SjylS4DhAPzPoZgQ49x","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>